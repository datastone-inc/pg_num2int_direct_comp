-- Test: Special Values (NaN, Infinity) for Direct Float-Integer Comparison
-- Purpose: Verify IEEE 754 special value handling for float4 and float8 operators
-- NaN Tests: NaN should not equal anything (including itself in comparisons)
SELECT '''NaN''::float4 = 100::int4'::text AS test, 'NaN'::float4 = 100::int4 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float4 = 100::int4 | f
(1 row)

SELECT '100::float4 = ''NaN''::int4 (should error)'::text AS test, 'NaN check skipped' AS result;  -- int4 cannot hold NaN
                   test                   |      result       
------------------------------------------+-------------------
 100::float4 = 'NaN'::int4 (should error) | NaN check skipped
(1 row)

SELECT '''NaN''::float8 = 100::int4'::text AS test, 'NaN'::float8 = 100::int4 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float8 = 100::int4 | f
(1 row)

SELECT '''NaN''::float4 <> 100::int4'::text AS test, 'NaN'::float4 <> 100::int4 AS result;
            test            | result 
----------------------------+--------
 'NaN'::float4 <> 100::int4 | t
(1 row)

SELECT '''NaN''::float8 <> 100::int4'::text AS test, 'NaN'::float8 <> 100::int4 AS result;
            test            | result 
----------------------------+--------
 'NaN'::float8 <> 100::int4 | t
(1 row)

-- NaN comparison with range operators (NaN comparisons always return false per IEEE 754)
SELECT '''NaN''::float4 < 100::int4'::text AS test, 'NaN'::float4 < 100::int4 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float4 < 100::int4 | f
(1 row)

SELECT '''NaN''::float4 > 100::int4'::text AS test, 'NaN'::float4 > 100::int4 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float4 > 100::int4 | t
(1 row)

SELECT '''NaN''::float4 <= 100::int4'::text AS test, 'NaN'::float4 <= 100::int4 AS result;
            test            | result 
----------------------------+--------
 'NaN'::float4 <= 100::int4 | f
(1 row)

SELECT '''NaN''::float4 >= 100::int4'::text AS test, 'NaN'::float4 >= 100::int4 AS result;
            test            | result 
----------------------------+--------
 'NaN'::float4 >= 100::int4 | t
(1 row)

SELECT '''NaN''::float8 < 100::int8'::text AS test, 'NaN'::float8 < 100::int8 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float8 < 100::int8 | f
(1 row)

SELECT '''NaN''::float8 > 100::int8'::text AS test, 'NaN'::float8 > 100::int8 AS result;
           test            | result 
---------------------------+--------
 'NaN'::float8 > 100::int8 | t
(1 row)

-- Infinity Tests: +Infinity
SELECT '''Infinity''::float4 = 100::int4'::text AS test, 'Infinity'::float4 = 100::int4 AS result;  -- Should be false
              test              | result 
--------------------------------+--------
 'Infinity'::float4 = 100::int4 | f
(1 row)

SELECT '''Infinity''::float4 > 100::int4'::text AS test, 'Infinity'::float4 > 100::int4 AS result;  -- Should be true
              test              | result 
--------------------------------+--------
 'Infinity'::float4 > 100::int4 | t
(1 row)

SELECT '''Infinity''::float4 < 100::int4'::text AS test, 'Infinity'::float4 < 100::int4 AS result;  -- Should be false
              test              | result 
--------------------------------+--------
 'Infinity'::float4 < 100::int4 | f
(1 row)

SELECT '''Infinity''::float8 = 100::int8'::text AS test, 'Infinity'::float8 = 100::int8 AS result;  -- Should be false
              test              | result 
--------------------------------+--------
 'Infinity'::float8 = 100::int8 | f
(1 row)

SELECT '''Infinity''::float8 > 100::int8'::text AS test, 'Infinity'::float8 > 100::int8 AS result;  -- Should be true
              test              | result 
--------------------------------+--------
 'Infinity'::float8 > 100::int8 | t
(1 row)

SELECT '''Infinity''::float8 >= 100::int8'::text AS test, 'Infinity'::float8 >= 100::int8 AS result;  -- Should be true
              test               | result 
---------------------------------+--------
 'Infinity'::float8 >= 100::int8 | t
(1 row)

-- Infinity Tests: -Infinity
SELECT '''-Infinity''::float4 = 100::int4'::text AS test, '-Infinity'::float4 = 100::int4 AS result;  -- Should be false
              test               | result 
---------------------------------+--------
 '-Infinity'::float4 = 100::int4 | f
(1 row)

SELECT '''-Infinity''::float4 < 100::int4'::text AS test, '-Infinity'::float4 < 100::int4 AS result;  -- Should be true
              test               | result 
---------------------------------+--------
 '-Infinity'::float4 < 100::int4 | t
(1 row)

SELECT '''-Infinity''::float4 > 100::int4'::text AS test, '-Infinity'::float4 > 100::int4 AS result;  -- Should be false
              test               | result 
---------------------------------+--------
 '-Infinity'::float4 > 100::int4 | f
(1 row)

SELECT '''-Infinity''::float8 = 100::int8'::text AS test, '-Infinity'::float8 = 100::int8 AS result;  -- Should be false
              test               | result 
---------------------------------+--------
 '-Infinity'::float8 = 100::int8 | f
(1 row)

SELECT '''-Infinity''::float8 < 100::int8'::text AS test, '-Infinity'::float8 < 100::int8 AS result;  -- Should be true
              test               | result 
---------------------------------+--------
 '-Infinity'::float8 < 100::int8 | t
(1 row)

SELECT '''-Infinity''::float8 <= 100::int8'::text AS test, '-Infinity'::float8 <= 100::int8 AS result;  -- Should be true
               test               | result 
----------------------------------+--------
 '-Infinity'::float8 <= 100::int8 | t
(1 row)

-- Edge Case: Infinity compared to max integer values
SELECT '''Infinity''::float4 > 2147483647::int4'::text AS test, 'Infinity'::float4 > 2147483647::int4 AS result;  -- Should be true
                 test                  | result 
---------------------------------------+--------
 'Infinity'::float4 > 2147483647::int4 | t
(1 row)

SELECT '''Infinity''::float8 > 9223372036854775807::int8'::text AS test, 'Infinity'::float8 > 9223372036854775807::int8 AS result;  -- Should be true
                      test                      | result 
------------------------------------------------+--------
 'Infinity'::float8 > 9223372036854775807::int8 | t
(1 row)

SELECT '''-Infinity''::float4 < -2147483648::int4'::text AS test, '-Infinity'::float4 < (-2147483648)::int4 AS result;  -- Should be true
                  test                   | result 
-----------------------------------------+--------
 '-Infinity'::float4 < -2147483648::int4 | t
(1 row)

SELECT '''-Infinity''::float8 < -9223372036854775808::int8'::text AS test, '-Infinity'::float8 < (-9223372036854775808)::int8 AS result;  -- Should be true
                       test                       | result 
--------------------------------------------------+--------
 '-Infinity'::float8 < -9223372036854775808::int8 | t
(1 row)

-- Special Values in tables
CREATE TEMPORARY TABLE t_special (id INT4, val_f4 FLOAT4, val_f8 FLOAT8);
INSERT INTO t_special VALUES (1, 'NaN', 'NaN'), (2, 'Infinity', 'Infinity'), (3, '-Infinity', '-Infinity'), (4, 100, 100);
SELECT 'NaN in WHERE (should return 0)'::text AS test, COUNT(*) AS count FROM t_special WHERE val_f4 = 100::int4;
              test              | count 
--------------------------------+-------
 NaN in WHERE (should return 0) |     1
(1 row)

SELECT 'Infinity > int4 (should return 1)'::text AS test, COUNT(*) AS count FROM t_special WHERE val_f4 > 2147483647::int4;
               test                | count 
-----------------------------------+-------
 Infinity > int4 (should return 1) |     2
(1 row)

SELECT '-Infinity < int4 (should return 1)'::text AS test, COUNT(*) AS count FROM t_special WHERE val_f4 < (-2147483648)::int4;
                test                | count 
------------------------------------+-------
 -Infinity < int4 (should return 1) |     1
(1 row)

SELECT 'Normal value = int4 (should return 1)'::text AS test, COUNT(*) AS count FROM t_special WHERE val_f4 = 100::int4;
                 test                  | count 
---------------------------------------+-------
 Normal value = int4 (should return 1) |     1
(1 row)

-- NaN vs Infinity (PostgreSQL semantics: NaN = NaN is false, NaN > all non-NaN for ordering)
SELECT '''NaN''::float4 = ''Infinity''::float4'::text AS test, 'NaN'::float4 = 'Infinity'::float4 AS result;  -- Should be false (NaN never equals anything)
                test                | result 
------------------------------------+--------
 'NaN'::float4 = 'Infinity'::float4 | f
(1 row)

SELECT '''NaN''::float4 > ''Infinity''::float4'::text AS test, 'NaN'::float4 > 'Infinity'::float4 AS result;  -- Should be true (PostgreSQL: NaN > all for sorting)
                test                | result 
------------------------------------+--------
 'NaN'::float4 > 'Infinity'::float4 | t
(1 row)

SELECT '''NaN''::float4 < ''-Infinity''::float4'::text AS test, 'NaN'::float4 < '-Infinity'::float4 AS result;  -- Should be false (PostgreSQL: NaN is never less than anything)
                test                 | result 
-------------------------------------+--------
 'NaN'::float4 < '-Infinity'::float4 | f
(1 row)

